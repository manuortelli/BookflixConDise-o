{"ast":null,"code":"var _jsxFileName = \"D:\\\\Documentos\\\\GitHub\\\\bf\\\\front-end\\\\src\\\\components\\\\VistaSuscriptor\\\\Libros\\\\DetalleLibro.js\";\nimport React, { Component, useState } from \"react\";\nimport axios from \"axios\";\nimport DatosLibro from \"./DatosLibro\";\nimport { Link } from \"react-router-dom\";\nimport ListarCapitulos from \"./ListarCapitulos\";\nimport { Button } from \"react-bootstrap\";\nimport MostrarTrailersAsociados from \"../Trailers/MostrarTrailersAsociados\";\nimport HeartCheckbox from 'react-heart-checkbox';\nconst perfiles = \"http://localhost:4000/api/perfiles/\";\nconst editoriales = \"http://localhost:4000/api/editoriales/\";\nconst generos = \"http://localhost:4000/api/generos/\";\nconst autores = \"http://localhost:4000/api/autores/\";\nconst Trailers = \"http://localhost:4000/api/trailers\";\nconst portada = \"http://localhost:4000/uploads/\";\nconst me = \"http://localhost:4000/api/libros/me\";\nconst terminado = \"http://localhost:4000/api/libros/terminado\";\nconst capi = \"http://localhost:4000/api/libros/misCapitulos\";\nconst loginPerfilApi = \"http://localhost:4000/api/suscriptores/loginPerfil\";\nexport default class DetalleLibrosAdmin extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getNombres = async () => {\n      //traigo el autor actual\n      await axios.post(autores + \"me\", {\n        id: this.state.libro.autor\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        console.log(res.data);\n        this.setState({\n          autor: res.data\n        });\n      }).catch(err => {\n        console.log(err);\n      }); //traigo el genero actual\n\n      await axios.post(generos + \"me\", {\n        id: this.state.libro.genero\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        console.log(res.data);\n        this.setState({\n          genero: res.data\n        });\n      }).catch(err => {\n        console.log(err);\n      }); //traigo la editorial actual\n\n      await axios.post(editoriales + \"me\", {\n        id: this.state.libro.editorial\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        this.setState({\n          editorial: res.data\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n\n    this.actualizarPerfil = async () => {\n      console.log(this.state.perfil);\n      await axios.post(loginPerfilApi, {\n        id: this.state.perfil._id\n      }, {\n        headers: {\n          xaccess: sessionStorage.getItem(\"token\")\n        }\n      }).then(res => {\n        const {\n          user,\n          token\n        } = res.data;\n        sessionStorage.setItem(\"token\", token);\n        sessionStorage.setItem(\"perfilUser\", JSON.stringify(user));\n        sessionStorage.setItem(\"perfil\", res.data.user);\n        sessionStorage.setItem(\"perfilID\", user._id);\n      });\n    };\n\n    this.getTrailer = async () => {\n      console.log(this.state.libro.trailer);\n      console.log(this.state.libro.trailer != null || this.state.libro.trailer != '');\n\n      if (this.state.libro.trailer != null) {\n        this.state.hayTrailer = true;\n        /* await axios\r\n        .post(\r\n         Trailers + \"me\",\r\n         { id: this.state.libro.trailer },\r\n         { headers: { xaccess: this.state.token } }\r\n        )\r\n        .then((res) => {\r\n         \r\n         this.setState({\r\n           trailer: res.data,\r\n           hayTrailer:true,\r\n         });\r\n        })\r\n        .catch((err) => {\r\n         console.log(err.response.data.msg);\r\n        });\r\n        */\n      }\n    };\n\n    this.getTermine = async () => {\n      await axios.post(terminado, {\n        id: this.state.id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        console.log(res.data);\n\n        if (res.data.finalizado == true) {\n          this.setState({\n            botonTermine: true\n          });\n        }\n\n        this.actualizarPerfil();\n      });\n    };\n\n    this.getDatos = async () => {\n      await axios.post(me, {\n        id: this.state.id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        this.setState({\n          libro: res.data,\n          capitulos: res.data.capitulos\n        });\n        this.getCapitulos();\n        this.getNombres();\n        this.HayCapitulos();\n        this.getTrailer();\n        this.getTermine();\n        this.tieneLike();\n      }).catch(err => {\n        console.log(err);\n      });\n    };\n\n    this.filtrarFechas = libros => {\n      console.log(\"Lo que llega aca mirar por favor\", libros);\n      var res = [];\n      const hoyEntera = new Date();\n      libros.map(lib => {\n        if (lib.lanzamiento != null) {\n          const hoy = JSON.stringify(new Date().getDate());\n          const mes = JSON.stringify(new Date().getMonth() + 1);\n          const año = JSON.stringify(new Date().getFullYear());\n          const lanMes = JSON.stringify(new Date(lib.lanzamiento).getMonth() + 1);\n          const lanHoy = JSON.stringify(new Date(lib.lanzamiento).getDate());\n          const lanAño = JSON.stringify(new Date(lib.lanzamiento).getFullYear());\n          const lanzaEntera = new Date(lib.lanzamiento);\n\n          if (lanHoy == hoy & lanMes == mes & lanAño == año || lanzaEntera < hoyEntera) {\n            if (lib.vencimiento != null) {\n              var ven = new Date(lib.vencimiento);\n              const venciMes = JSON.stringify(new Date(lib.vencimiento).getMonth() + 1);\n              const venciHoy = JSON.stringify(new Date(lib.vencimiento).getDate());\n              const venciAño = JSON.stringify(new Date(lib.vencimiento).getFullYear());\n              const venciEntera = new Date(lib.vencimiento);\n\n              if (venciHoy == hoy & venciMes == mes & venciAño == año || venciEntera > hoyEntera) {\n                res.push(lib);\n              }\n            } else {\n              res.push(lib);\n            }\n          }\n        }\n      });\n      this.setState({\n        capitulosActivos: res\n      });\n    };\n\n    this.filtrarCapitulos = capi => {\n      console.log(\"Esto llega a filtrar capitulos\", capi);\n      var validos = [];\n      const hoy = JSON.stringify(new Date().getDate());\n      const mes = JSON.stringify(new Date().getMonth() + 1);\n      const año = JSON.stringify(new Date().getFullYear());\n      const hoyEntera = JSON.stringify(new Date());\n\n      if (capi != []) {\n        capi.map(cap => {\n          const lanzaHoy = JSON.stringify(new Date(cap.lanzamiento).getDate());\n          const lanzaMes = JSON.stringify(new Date(cap.lanzamiento).getMonth() + 1);\n          const lanzaAño = JSON.stringify(new Date(cap.lanzamiento).getFullYear());\n          const lanzaEntera = JSON.stringify(new Date(capi.lanzamiento));\n\n          if (hoy == lanzaHoy & mes == lanzaMes & año == lanzaAño || lanzaEntera > hoyEntera) {\n            if (cap.vencimiento) {\n              const venciHoy = JSON.stringify(new Date(cap.lanzamiento).getDate());\n              const venciMes = JSON.stringify(new Date(cap.lanzamiento).getMonth() + 1);\n              const venciAño = JSON.stringify(new Date(cap.lanzamiento).getFullYear());\n              const venciEntera = JSON.stringify(new Date(cap.vencimiento));\n\n              if (venciHoy == hoy & venciMes == mes & venciAño == año || venciEntera > hoyEntera) {\n                validos.push(cap);\n              }\n            } else {\n              validos.push(cap);\n            }\n          }\n        });\n        this.setState({\n          capitulosActivos: validos\n        });\n      }\n\n      console.log(\"CAPITULOS DESPUES DE FILTRARLOS\", this.state.capitulosActivos);\n    };\n\n    this.getCapitulos = async () => {\n      await axios.post(capi, {\n        id: this.props.match.params.id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        this.setState({\n          capi: res.data\n        });\n        this.filtrarFechas(res.data);\n      }).catch(err => {\n        console.log(err);\n        alert(JSON.stringify(err.response.data.msg));\n      });\n    };\n\n    this.tieneLike = () => {\n      this.state.miPerfil.likesLibros.forEach(element => {\n        console.log(element);\n\n        if (element.id == this.props.match.params.id) {\n          this.setState({\n            botonlike: true\n          });\n        }\n      });\n    };\n\n    this.HayCapitulos = () => {\n      if (this.state.capitulos != \"\") {\n        this.state.bottonCap = true;\n      }\n    };\n\n    this.leerLibro = async () => {\n      if (!this.state.bottonCap) {\n        await axios.post(perfiles + \"visitadoLibro\", {\n          id: sessionStorage.getItem(\"perfilID\"),\n          libroId: this.state.id\n        }, {\n          headers: {\n            xaccess: this.state.token\n          }\n        }).then(res => {\n          console.log(res.data);\n        }).catch(err => {\n          console.log(err);\n          alert(JSON.stringify(err.response.data.msg));\n        });\n      }\n    };\n\n    this.fechaExpiracion = () => {\n      if (!this.props.libro.fechaExpiracion) {\n        return /*#__PURE__*/React.createElement(\"h6\", {\n          className: \"card-subtitle mb-2 text-muted\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 9\n          }\n        }, \"Fecha de expiraci\\xF3n: \", this.state.libro.expiracion);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 391,\n            columnNumber: 14\n          }\n        });\n      }\n    };\n\n    this.termineLibro = async () => {\n      await axios.post(perfiles + \"termineLibro\", {\n        id: sessionStorage.getItem(\"perfilID\"),\n        libroId: this.state.libro._id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        alert(res.data.msg);\n      }).catch(err => {\n        alert(err.response.data.msg);\n      });\n    };\n\n    this.onClickLike = async () => {\n      console.log(\"Aca presta atención\", this.state.id);\n      this.setState({\n        botonlike: !this.state.botonlike\n      });\n      await axios.post(perfiles + 'likeLibro', {\n        id: this.state.miPerfil._id,\n        idLibro: this.state.id\n      }, {\n        headers: {\n          xaccess: this.state.token\n        }\n      }).then(res => {\n        alert(res.data.msg);\n      }).catch(err => {\n        alert(err.response.data.msg);\n      });\n    };\n\n    this.mostrarCrearReseña = () => {\n      const even = element => {\n        if (element.libro === this.state.id) {\n          if (element.terminado == \"true\") {\n            return true;\n          }\n        }\n\n        return false;\n      };\n\n      if (this.state.perfil.historialLibros.some(even)) {\n        this.setState({\n          mostrarCrearReseña: true\n        });\n      }\n    };\n\n    this.state = {\n      id: this.props.match.params.id,\n      token: sessionStorage.getItem(\"token\"),\n      perfil: JSON.parse(sessionStorage.getItem(\"perfilUser\")),\n      miPerfil: JSON.parse(sessionStorage.getItem(\"perfilUser\")),\n      libro: \"\",\n      capitulos: \"\",\n      editorial: \"\",\n      genero: \"\",\n      autor: \"\",\n      bottonCap: false,\n      mostrarCapitulos: false,\n      trailer: null,\n      hayTrailer: false,\n      capi: [],\n      capitulosActivos: [],\n      botonTermine: false,\n      botonlike: false,\n      verReseñas: false,\n      mostrarCrearReseña: false,\n      reseñas: [{\n        comentario: 'muy buen libro',\n        ranting: 5,\n        spoiler: false,\n        autor: {\n          nombre: 'Macri'\n        }\n      }, {\n        comentario: 'lo recomiendo',\n        ranting: 4,\n        spoiler: true,\n        autor: {\n          nombre: 'Alberto toto'\n        }\n      }, {\n        comentario: 'malisimooo',\n        ranting: 1,\n        spoiler: false,\n        autor: {\n          nombre: 'Anonimus'\n        }\n      }, {\n        comentario: 'al final muere Thanos',\n        ranting: 3,\n        spoiler: true,\n        autor: {\n          nombre: 'Messi'\n        }\n      }]\n    };\n    this.fechaExpiracion = this.fechaExpiracion.bind(this);\n    this.mostrarCapitulos = this.mostrarCapitulos.bind(this);\n  }\n\n  mostrarCapitulos() {\n    this.setState({\n      mostrarCapitulos: !this.state.mostrarCapitulos\n    });\n    console.log(this.state.mostrarCapitulos);\n  }\n\n  componentDidMount() {\n    console.log(\"Aca hijo de puta\", this.state.miPerfil.likesLibros);\n    console.log(\"id del libro\", this.state.id);\n    this.mostrarCrearReseña();\n    this.getDatos();\n    this.HayCapitulos();\n    this.actualizarPerfil();\n  }\n\n  render() {\n    const show = this.state.bottonCap;\n    const termineL = this.state.botonTermine;\n    const hayTrailer = this.state.hayTrailer;\n    const mostrarCrearReseña = this.state.mostrarCrearReseña;\n    console.log(this.state.botonlike);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 482,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cardDetalleLibro\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      className: \"card-title text-light \",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 485,\n        columnNumber: 15\n      }\n    }, \" \", this.state.libro.titulo), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"botonlike\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(HeartCheckbox, {\n      checked: this.state.botonlike,\n      onClick: this.onClickLike,\n      tabindex: \"0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"img\", {\n      src: portada + `${this.state.libro.portada}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 497,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"bodyDetalleLibro\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"card-subtitle mb-2 text-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 502,\n        columnNumber: 17\n      }\n    }, \"Editorial: \", \" \" + this.state.editorial.nombre), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"card-subtitle mb-2 text-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 506,\n        columnNumber: 17\n      }\n    }, \"Autor:\", \" \", \" \" + this.state.autor.nombre + \" \" + this.state.autor.apellido), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 513,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"card-subtitle mb-2 text-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 17\n      }\n    }, \"Genero: \", \" \" + this.state.genero.nombre), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"card-subtitle mb-2 text-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 17\n      }\n    }, \"ISBN: \", \" \" + this.state.libro.isbn)), termineL ? /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      height: \"200px\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 524,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-outline-danger\",\n      onClick: this.termineLibro,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 525,\n        columnNumber: 21\n      }\n    }, \"Termine\"))) : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 19\n      }\n    }), hayTrailer ? /*#__PURE__*/React.createElement(Link, {\n      className: \"btn btn-outline-danger itemBoton\",\n      to: '/suscriptor/trailers/detalle/' + this.state.libro.trailer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 539,\n        columnNumber: 17\n      }\n    }, \"Ver Trailer\") : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 542,\n        columnNumber: 20\n      }\n    }, \" \"), mostrarCrearReseña ? /*#__PURE__*/React.createElement(Link, {\n      className: \"btn btn-outline-danger itemBoton\",\n      to: '/suscriptor/libros/reseña/' + this.state.libro._id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 546,\n        columnNumber: 19\n      }\n    }, \"Agregar Rese\\xF1a\") : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 549,\n        columnNumber: 18\n      }\n    })), show ? /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 556,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ListarCapitulos, {\n      capitulos: this.state.capitulosActivos,\n      libroId: this.state.libro._id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 558,\n        columnNumber: 17\n      }\n    })) : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 565,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"btn-leerlibro\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 567,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      onClick: this.leerLibro,\n      className: \"btn btn-outline-danger itemBoton\",\n      to: \"/suscriptor/libros/leer/\" + this.state.libro.archivo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 568,\n        columnNumber: 21\n      }\n    }, \" \", \"Leer Libro\", \" \"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"btn-leerlibro\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 580,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      onClick: this.leerLibro,\n      className: \"btn btn-outline-danger itemBoton\",\n      to: \"/suscriptor/reseñas/\" + this.state.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 581,\n        columnNumber: 21\n      }\n    }, \" \", \"Ver Rese\\xF1as\", \" \")))));\n  }\n\n}","map":{"version":3,"sources":["D:/Documentos/GitHub/bf/front-end/src/components/VistaSuscriptor/Libros/DetalleLibro.js"],"names":["React","Component","useState","axios","DatosLibro","Link","ListarCapitulos","Button","MostrarTrailersAsociados","HeartCheckbox","perfiles","editoriales","generos","autores","Trailers","portada","me","terminado","capi","loginPerfilApi","DetalleLibrosAdmin","constructor","props","getNombres","post","id","state","libro","autor","headers","xaccess","token","then","res","console","log","data","setState","catch","err","genero","editorial","actualizarPerfil","perfil","_id","sessionStorage","getItem","user","setItem","JSON","stringify","getTrailer","trailer","hayTrailer","getTermine","finalizado","botonTermine","getDatos","capitulos","getCapitulos","HayCapitulos","tieneLike","filtrarFechas","libros","hoyEntera","Date","map","lib","lanzamiento","hoy","getDate","mes","getMonth","año","getFullYear","lanMes","lanHoy","lanAño","lanzaEntera","vencimiento","ven","venciMes","venciHoy","venciAño","venciEntera","push","capitulosActivos","filtrarCapitulos","validos","cap","lanzaHoy","lanzaMes","lanzaAño","match","params","alert","response","msg","miPerfil","likesLibros","forEach","element","botonlike","bottonCap","leerLibro","libroId","fechaExpiracion","expiracion","termineLibro","onClickLike","idLibro","mostrarCrearReseña","even","historialLibros","some","parse","mostrarCapitulos","verReseñas","reseñas","comentario","ranting","spoiler","nombre","bind","componentDidMount","render","show","termineL","titulo","apellido","isbn","archivo"],"mappings":"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","sourcesContent":["import React, { Component, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport DatosLibro from \"./DatosLibro\";\r\nimport { Link } from \"react-router-dom\";\r\nimport ListarCapitulos from \"./ListarCapitulos\";\r\nimport { Button } from \"react-bootstrap\";\r\nimport MostrarTrailersAsociados from \"../Trailers/MostrarTrailersAsociados\";\r\nimport HeartCheckbox from 'react-heart-checkbox';\r\n\r\nconst perfiles = \"http://localhost:4000/api/perfiles/\";\r\nconst editoriales = \"http://localhost:4000/api/editoriales/\";\r\nconst generos = \"http://localhost:4000/api/generos/\";\r\nconst autores = \"http://localhost:4000/api/autores/\";\r\nconst Trailers = \"http://localhost:4000/api/trailers\";\r\n\r\nconst portada = \"http://localhost:4000/uploads/\";\r\nconst me = \"http://localhost:4000/api/libros/me\";\r\nconst terminado = \"http://localhost:4000/api/libros/terminado\";\r\nconst capi = \"http://localhost:4000/api/libros/misCapitulos\";\r\nconst loginPerfilApi = \"http://localhost:4000/api/suscriptores/loginPerfil\";\r\n\r\n\r\nexport default class DetalleLibrosAdmin extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      id: this.props.match.params.id,\r\n      token: sessionStorage.getItem(\"token\"),\r\n      perfil: JSON.parse(sessionStorage.getItem(\"perfilUser\")),\r\n      miPerfil: JSON.parse(sessionStorage.getItem(\"perfilUser\")),\r\n      libro: \"\",\r\n      capitulos: \"\",\r\n      editorial: \"\",\r\n      genero: \"\",\r\n      autor: \"\",\r\n      bottonCap: false,\r\n      mostrarCapitulos: false,\r\n      trailer: null,\r\n      hayTrailer: false,\r\n      capi: [],\r\n      capitulosActivos: [],\r\n      botonTermine: false,\r\n      botonlike: false,\r\n      verReseñas:false,\r\n      mostrarCrearReseña:false,\r\n\r\n      reseñas:[{\r\n        comentario:'muy buen libro',\r\n        ranting:5,\r\n        spoiler:false,\r\n        autor:{nombre: 'Macri' }\r\n    },{\r\n        comentario:'lo recomiendo',\r\n        ranting:4,\r\n        spoiler:true,\r\n        autor:{nombre: 'Alberto toto' }\r\n    },{\r\n        comentario:'malisimooo',\r\n        ranting:1,\r\n        spoiler:false,\r\n        autor:{nombre: 'Anonimus' }\r\n    },\r\n    {\r\n        comentario:'al final muere Thanos',\r\n        ranting:3,\r\n        spoiler:true,\r\n        autor:{nombre: 'Messi' }\r\n    }\r\n\r\n\r\n],\r\n    };\r\n    this.fechaExpiracion = this.fechaExpiracion.bind(this);\r\n    this.mostrarCapitulos = this.mostrarCapitulos.bind(this);\r\n  }\r\n\r\n  getNombres = async () => {\r\n    //traigo el autor actual\r\n    await axios\r\n      .post(\r\n        autores + \"me\",\r\n        { id: this.state.libro.autor },\r\n        { headers: { xaccess: this.state.token } }\r\n      )\r\n      .then((res) => {\r\n        console.log(res.data);\r\n        this.setState({\r\n          autor: res.data,\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n\r\n    //traigo el genero actual\r\n    await axios\r\n      .post(\r\n        generos + \"me\",\r\n        { id: this.state.libro.genero },\r\n        { headers: { xaccess: this.state.token } }\r\n      )\r\n      .then((res) => {\r\n        console.log(res.data);\r\n        this.setState({\r\n          genero: res.data,\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n\r\n    //traigo la editorial actual\r\n    await axios\r\n      .post(\r\n        editoriales + \"me\",\r\n        { id: this.state.libro.editorial },\r\n        { headers: { xaccess: this.state.token } }\r\n      )\r\n      .then((res) => {\r\n        this.setState({\r\n          editorial: res.data,\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n\r\n  actualizarPerfil = async () => {\r\n    console.log(this.state.perfil );\r\n    \r\n\r\n    await axios\r\n        .post(\r\n            loginPerfilApi,\r\n            { id: this.state.perfil._id },\r\n            {\r\n                headers: { xaccess: sessionStorage.getItem(\"token\") },\r\n            }\r\n        )\r\n        .then((res) => {\r\n\r\n            const { user, token } = res.data;\r\n            sessionStorage.setItem(\"token\", token);\r\n            sessionStorage.setItem(\"perfilUser\", JSON.stringify(user));\r\n            sessionStorage.setItem(\"perfil\", res.data.user);\r\n            sessionStorage.setItem(\"perfilID\", user._id);\r\n           \r\n\r\n\r\n        });\r\n\r\n}\r\n\r\n\r\n  getTrailer = async () => {\r\n    console.log(this.state.libro.trailer)\r\n    console.log((this.state.libro.trailer != null) || (this.state.libro.trailer != ''))\r\n    if ((this.state.libro.trailer != null)) {\r\n\r\n      this.state.hayTrailer = true\r\n\r\n      /* await axios\r\n     .post(\r\n       Trailers + \"me\",\r\n       { id: this.state.libro.trailer },\r\n       { headers: { xaccess: this.state.token } }\r\n     )\r\n     .then((res) => {\r\n       \r\n       this.setState({\r\n         trailer: res.data,\r\n         hayTrailer:true,\r\n       });\r\n     })\r\n     .catch((err) => {\r\n       console.log(err.response.data.msg);\r\n     });\r\n   */\r\n    }\r\n  };\r\n\r\n  getTermine = async () => {\r\n    await axios\r\n      .post(\r\n        terminado,\r\n        {\r\n          id: this.state.id,\r\n        },\r\n        { headers: { xaccess: this.state.token } }\r\n      )\r\n      .then((res) => {\r\n        console.log(res.data);\r\n        if (res.data.finalizado == true) {\r\n        this.setState({botonTermine:true})\r\n        }\r\n        this.actualizarPerfil();\r\n      });\r\n  };\r\n\r\n  getDatos = async () => {\r\n    await axios\r\n      .post(\r\n        me,\r\n        { id: this.state.id },\r\n        { headers: { xaccess: this.state.token } }\r\n      )\r\n      .then((res) => {\r\n        this.setState({\r\n          libro: res.data,\r\n          capitulos: res.data.capitulos,\r\n        });\r\n        this.getCapitulos();\r\n        this.getNombres();\r\n        this.HayCapitulos();\r\n        this.getTrailer();\r\n        this.getTermine();\r\n        this.tieneLike();\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  };\r\n\r\n  filtrarFechas = (libros) => {\r\n    console.log(\"Lo que llega aca mirar por favor\", libros)\r\n    var res = [];\r\n    const hoyEntera = new Date();\r\n    libros.map((lib) => {\r\n      if (lib.lanzamiento != null) {\r\n        const hoy = JSON.stringify(new Date().getDate());\r\n        const mes = JSON.stringify(new Date().getMonth() + 1);\r\n        const año = JSON.stringify(new Date().getFullYear());\r\n\r\n        const lanMes = JSON.stringify(new Date(lib.lanzamiento).getMonth() + 1);\r\n\r\n        const lanHoy = JSON.stringify(new Date(lib.lanzamiento).getDate());\r\n\r\n        const lanAño = JSON.stringify(new Date(lib.lanzamiento).getFullYear());\r\n        const lanzaEntera = new Date(lib.lanzamiento);\r\n        if (\r\n          (lanHoy == hoy) & (lanMes == mes) & (lanAño == año) ||\r\n          lanzaEntera < hoyEntera\r\n        ) {\r\n          if (lib.vencimiento != null) {\r\n            var ven = new Date(lib.vencimiento);\r\n            const venciMes = JSON.stringify(\r\n              new Date(lib.vencimiento).getMonth() + 1\r\n            );\r\n\r\n            const venciHoy = JSON.stringify(new Date(lib.vencimiento).getDate());\r\n\r\n            const venciAño = JSON.stringify(\r\n              new Date(lib.vencimiento).getFullYear()\r\n            );\r\n            const venciEntera = new Date(lib.vencimiento);\r\n\r\n            if (\r\n              (venciHoy == hoy) & (venciMes == mes) & (venciAño == año) ||\r\n              venciEntera > hoyEntera\r\n            ) {\r\n              res.push(lib);\r\n            }\r\n          } else {\r\n            res.push(lib);\r\n          }\r\n        }\r\n      }\r\n    });\r\n    this.setState({\r\n      capitulosActivos: res,\r\n    });\r\n  };\r\n\r\n  filtrarCapitulos = (capi) => {\r\n    console.log(\"Esto llega a filtrar capitulos\", capi)\r\n    var validos = [];\r\n\r\n    const hoy = JSON.stringify(new Date().getDate());\r\n    const mes = JSON.stringify(new Date().getMonth() + 1);\r\n    const año = JSON.stringify(new Date().getFullYear());\r\n    const hoyEntera = JSON.stringify(new Date());\r\n\r\n    if (capi != []) {\r\n      capi.map((cap) => {\r\n        const lanzaHoy = JSON.stringify(new Date(cap.lanzamiento).getDate());\r\n        const lanzaMes = JSON.stringify(\r\n          new Date(cap.lanzamiento).getMonth() + 1\r\n        );\r\n        const lanzaAño = JSON.stringify(\r\n          new Date(cap.lanzamiento).getFullYear()\r\n        );\r\n        const lanzaEntera = JSON.stringify(new Date(capi.lanzamiento));\r\n        if (\r\n          (hoy == lanzaHoy) & (mes == lanzaMes) & (año == lanzaAño) ||\r\n          lanzaEntera > hoyEntera\r\n        ) {\r\n          if (cap.vencimiento) {\r\n            const venciHoy = JSON.stringify(\r\n              new Date(cap.lanzamiento).getDate()\r\n            );\r\n            const venciMes = JSON.stringify(\r\n              new Date(cap.lanzamiento).getMonth() + 1\r\n            );\r\n            const venciAño = JSON.stringify(\r\n              new Date(cap.lanzamiento).getFullYear()\r\n            );\r\n            const venciEntera = JSON.stringify(new Date(cap.vencimiento));\r\n\r\n            if (\r\n              (venciHoy == hoy) & (venciMes == mes) & (venciAño == año) ||\r\n              venciEntera > hoyEntera\r\n            ) {\r\n              validos.push(cap);\r\n            }\r\n          } else {\r\n            validos.push(cap);\r\n          }\r\n        }\r\n      });\r\n      this.setState({\r\n        capitulosActivos: validos,\r\n      });\r\n    }\r\n    console.log(\"CAPITULOS DESPUES DE FILTRARLOS\", this.state.capitulosActivos);\r\n  };\r\n\r\n  getCapitulos = async () => {\r\n    await axios\r\n      .post(\r\n        capi,\r\n        { id: this.props.match.params.id },\r\n        { headers: { xaccess: this.state.token } }\r\n      )\r\n      .then((res) => {\r\n        this.setState({\r\n          capi: res.data,\r\n        });\r\n\r\n        this.filtrarFechas(res.data);\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n        alert(JSON.stringify(err.response.data.msg));\r\n      });\r\n  };\r\n\r\n  tieneLike = () => {\r\n    this.state.miPerfil.likesLibros.forEach(element => {\r\n      console.log(element)\r\n      if (element.id == this.props.match.params.id) {\r\n        this.setState({ botonlike: true })\r\n      }\r\n    });\r\n  }\r\n\r\n  HayCapitulos = () => {\r\n    if (this.state.capitulos != \"\") {\r\n      this.state.bottonCap = true;\r\n    }\r\n  };\r\n\r\n  leerLibro = async () => {\r\n    if (!this.state.bottonCap) {\r\n      await axios\r\n        .post(\r\n          perfiles + \"visitadoLibro\",\r\n          { id: sessionStorage.getItem(\"perfilID\"), libroId: this.state.id },\r\n          { headers: { xaccess: this.state.token } }\r\n        )\r\n        .then((res) => {\r\n          console.log(res.data);\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n          alert(JSON.stringify(err.response.data.msg));\r\n        });\r\n    }\r\n  };\r\n\r\n\r\n  fechaExpiracion = () => {\r\n    if (!this.props.libro.fechaExpiracion) {\r\n      return (\r\n        <h6 className=\"card-subtitle mb-2 text-muted\">\r\n          Fecha de expiración: {this.state.libro.expiracion}\r\n        </h6>\r\n      );\r\n    } else {\r\n      return <div />;\r\n    }\r\n  };\r\n\r\n  mostrarCapitulos() {\r\n    this.setState({\r\n      mostrarCapitulos: !this.state.mostrarCapitulos,\r\n    });\r\n    console.log(this.state.mostrarCapitulos);\r\n  }\r\n\r\n  termineLibro = async () => {\r\n    await axios\r\n      .post(\r\n        perfiles + \"termineLibro\",\r\n        {\r\n          id: sessionStorage.getItem(\"perfilID\"),\r\n          libroId: this.state.libro._id,\r\n        },\r\n        { headers: { xaccess: this.state.token } }\r\n      )\r\n      .then((res) => {\r\n        alert(res.data.msg);\r\n      })\r\n      .catch((err) => {\r\n        alert(err.response.data.msg);\r\n      });\r\n  };\r\n\r\n  onClickLike = async () => {\r\n\r\n    console.log(\"Aca presta atención\", this.state.id)\r\n    this.setState({ botonlike: !this.state.botonlike });\r\n    await axios.post(\r\n      perfiles + 'likeLibro',\r\n      {\r\n        id: this.state.miPerfil._id,\r\n        idLibro: this.state.id,\r\n      },\r\n      { headers: { xaccess: this.state.token } }\r\n    )\r\n      .then((res) => {\r\n        alert(res.data.msg);\r\n      })\r\n      .catch((err) => {\r\n        alert(err.response.data.msg);\r\n      });\r\n\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    console.log(\"Aca hijo de puta\",this.state.miPerfil.likesLibros);\r\n    console.log(\"id del libro\",this.state.id);\r\n    this.mostrarCrearReseña();\r\n    this.getDatos();\r\n    this.HayCapitulos();\r\n    this.actualizarPerfil();\r\n    \r\n  }\r\n  mostrarCrearReseña=()=>{\r\n    const even = (element) =>{ \r\n      if(element.libro=== this.state.id){\r\n        if(element.terminado== \"true\"){\r\n          return true\r\n        }\r\n\r\n      }\r\n      return false\r\n      \r\n     };\r\n\r\n    if(this.state.perfil.historialLibros.some(even)){\r\n        this.setState({\r\n          mostrarCrearReseña:true\r\n        })\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n    \r\n    const show = this.state.bottonCap;\r\n    const termineL = this.state.botonTermine;\r\n    const hayTrailer = this.state.hayTrailer;\r\n    const mostrarCrearReseña=this.state.mostrarCrearReseña;\r\n    console.log(this.state.botonlike) \r\n    return (\r\n      <div>\r\n        <div className=\"container\">\r\n          <div className=\"cardDetalleLibro\">\r\n            <div className=\"card-body\">\r\n              <h3 className=\"card-title text-light \">\r\n                {\" \"}\r\n                {this.state.libro.titulo}\r\n              </h3>\r\n              <div className=\"botonlike\">\r\n                <HeartCheckbox checked={this.state.botonlike} onClick={this.onClickLike} tabindex=\"0\" />\r\n              </div>\r\n              <img src={portada + `${this.state.libro.portada}`} />\r\n\r\n\r\n\r\n\r\n              <br></br>\r\n\r\n\r\n              <div className=\"bodyDetalleLibro\">\r\n\r\n                <h6 className=\"card-subtitle mb-2 text-light\">\r\n                  Editorial: {\" \" + this.state.editorial.nombre}\r\n                </h6>\r\n                <p></p>\r\n                <h6 className=\"card-subtitle mb-2 text-light\">\r\n                  Autor:{\" \"}\r\n                  {\" \" +\r\n                    this.state.autor.nombre +\r\n                    \" \" +\r\n                    this.state.autor.apellido}\r\n                </h6>\r\n                <p></p>\r\n                <h6 className=\"card-subtitle mb-2 text-light\">\r\n                  Genero: {\" \" + this.state.genero.nombre}\r\n                </h6>\r\n                <p></p>\r\n                <h6 className=\"card-subtitle mb-2 text-light\">\r\n                  ISBN: {\" \" + this.state.libro.isbn}\r\n                </h6>\r\n              </div>\r\n              {termineL ? (\r\n                <React.Fragment>\r\n                  <div height=\"200px\">\r\n                    <button\r\n                      className=\"btn btn-outline-danger\"\r\n                      onClick={this.termineLibro}\r\n                    >\r\n                      Termine\r\n                    </button>\r\n                  </div>\r\n\r\n                </React.Fragment>\r\n              ) : (\r\n                  <React.Fragment></React.Fragment>\r\n                )}\r\n\r\n              {hayTrailer ? (\r\n                <Link className='btn btn-outline-danger itemBoton' to={'/suscriptor/trailers/detalle/' + this.state.libro.trailer}  >\r\n                  Ver Trailer\r\n                </Link>\r\n              ) : (<React.Fragment> </React.Fragment>)}\r\n\r\n\r\n              {mostrarCrearReseña?(\r\n                  <Link className=\"btn btn-outline-danger itemBoton\" to={'/suscriptor/libros/reseña/' + this.state.libro._id}>\r\n                  Agregar Reseña\r\n                  </Link>\r\n              ):(<React.Fragment></React.Fragment>)\r\n\r\n              }\r\n\r\n              \r\n            </div>\r\n            {show ? (\r\n              <React.Fragment>\r\n\r\n                <ListarCapitulos\r\n                  capitulos={this.state.capitulosActivos}\r\n                  libroId={this.state.libro._id}\r\n                ></ListarCapitulos>\r\n\r\n              </React.Fragment>\r\n            ) : (\r\n                <React.Fragment>\r\n\r\n                  <div className=\"btn-leerlibro\">\r\n                    <Link\r\n                      onClick={this.leerLibro}\r\n                      className=\"btn btn-outline-danger itemBoton\"\r\n                      to={\"/suscriptor/libros/leer/\" + this.state.libro.archivo}\r\n                    >\r\n                      {\" \"}\r\n                    Leer Libro{\" \"}\r\n                    </Link>\r\n                  </div>\r\n\r\n                </React.Fragment>\r\n              )}\r\n              <div className=\"btn-leerlibro\">\r\n                    <Link\r\n                      onClick={this.leerLibro}\r\n                      className=\"btn btn-outline-danger itemBoton\"\r\n                      to={\"/suscriptor/reseñas/\" + this.state.id}\r\n                    >\r\n                      {\" \"}\r\n                    Ver Reseñas{\" \"}\r\n                    </Link>\r\n                  </div>\r\n\r\n\r\n          </div>\r\n        </div>\r\n\r\n\r\n\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}